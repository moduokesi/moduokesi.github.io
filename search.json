[{"title":"Redis持久化问题排查","date":"2022-10-29T12:49:50.000Z","url":"/2022/10/29/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/","tags":[["问题解决","/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"]],"categories":[["Linux","/categories/Linux/"]],"content":"Redis持久化问题排查 前言：在学习黑马的Redis持久化课程时因为老师用的MobaXterm软件与我使用的VMware存在差异，同时，老师上传的视频的redis配置与我大为不同而导致了一系列的问题，在进行了一天的排查（死杠）后终于解决了问题，感慨良多。在遇到问题解决不了的时候还是要多回头看，没准在出发点就能找到问题了。 下面就将展示问题的描述和解决方案 问题描述 老师在使用MobaXterm软件时使用redis-server redis.conf命令指定配置文件在前台启动Redis 然而我在使用redis-server命令却出现了下面的两种情况： 第一种：不指定配置文件启动Redis 发现监听6379端口失败 第二种：指定配置文件启动Redis 这里要先cd到自己的Redis安装路径下，然后使用命令redis-server redis.conf 发现没有产生日志，这里使用ps -ef | grep redis查看后端端口占用情况 显然，后台端口已经被占用了，这里是因为Redis配置了开机自启动和后台启动，导致端口占用而无法使用redis-server命令 问题解决 在执行以下操作前建议使用VMware创建一个快照，防止后续操作不当导致虚拟机设置出现问题 先使用以下命令关闭后台端口 此时cd到Redis的安装目录下，使用命令ps -ef | grep redis查看后台端口占用情况，发现后台端口关闭 然后在当前路径下使用vi redis.conf关闭Redis后台启动 将 daemonize 修改为 no 这样Redis就不会在后台启动了！ 接着可以开心的使用redis-server redis.conf指定配置文件启动redis了！ 然而，如果你使用该命令后又出现了如下情况 发现当前窗口确实是像前台启动一样阻塞的，但是却没有任何日志信息输出，这时我们打开RESP等图形化界面看一下连接是否成功 嗯，确实成功了，说明Redis服务确实启动了，但还是没有日志文件，那么这是怎么回事呢？ 哈哈，不用着急，我们先使用ctrl + c停止当前端口，然后再回到RESP上发现连接终止，这就说明我们之前做的操作没有问题！现在我们回到终端，使用vi redis.conf命令进入到配置文件中 找到logfile，发现logfile后面的引号内为一个日志文件 这个时候一切都真相大白了，因为在一开始配置Redis时，我们将在logfile的引号内写入了一个日志文件名称（一开始的logfile内的引号默认是空的），这就导致了我们使用redis-server命令输出的日志都进入到这个日志文件中，所以启动时当然看不到任何信息了！现在我们将引号内的文件命删除，保存并退出 再次使用redis-server redis.conf命令启动Redis 启动成功，大功告成！"},{"title":"VMWare实现Redis持久化","date":"2022-10-28T12:49:50.000Z","url":"/2022/10/28/VMWare%E5%AE%9E%E7%8E%B0Redis%E6%8C%81%E4%B9%85%E5%8C%96/","tags":[["学习笔记","/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"]],"categories":[["Linux","/categories/Linux/"]],"content":"VMware实现Redis持久化 Redis持久化的作用 Redis是内存存储，如果出现服务器宕机、服务重启等情况可能会丢失数据，利用Redis持久化可以将数据写入磁盘中，这样Redis就可以利用持久化的文件进行数据恢复，数据安全性得以大大提升。 RDB RDB全称为Redis Database Backup file(Redis数据备份文件)，也被叫做Redis数据快照。简单来说就是把内存重的所有数据都记录道磁盘中。当Redis实例故障重启后，从磁盘读取快照文件，恢复数据。 RDB实现数据持久化有两种命令：save和bgsave save命令适合用于准备将Redis停机的情况。 在执行save命令时会占用Redis的主进程，阻塞所有命令，因此不适用于Redis正在运行的情况。 而bgsave命令会执行fork操作开启一个子进程，避免主进程收到影响。 此外，当Redis停机时会执行一次RDB操作进行数据备份。 下面将对该情况进行验证 RDB演示 使用redis-server redis.conf指令在任意路径下运行Redis 接下来创建一个新的终端创建连接，存入键值对 接着回到上一个终端使用ctrl + c关闭Redis，可以看到DB saved on disk表示文件正常保存 在当前路径下使用ll查看所有文件，看到dump.rdb快照文件已经生成 接着再次在当前终端使用redis-server redis.conf启动Redis，此时数据会自动恢复，回到另一个终端窗口 此时将使用ctrl + c关闭当前命令行客户端，重新使用redis-cli开启一个新的命令行 这时使用get num命令发现数据返回为789，（如果get num返回错误Error：Server closed the connection要将redis.conf的protected-mode设置为No关闭保护模式）表明数据备份成功 Redis停机自动执行RDB证明完毕！ 实现RDB的相关配置 这里需要 cd 到redis的安装目录下，我的安装目录在 /usr/local/src/redis-6.2.6下 这里老师用的MobaXterm可以直接使用第三方文件打开配置文件进行修改，因为我用的是VMware所以只能使用Linux命令进行修改配置 使用 vi redis.conf修改配置文件 这里有一些小技巧： 按下INSERT键进入修改状态，此时才可以对文件进行修改 按下ESC键可以使用一些命令：/xxx可以查找跳跃到当前文件中的xxx名称，:wq保存当前文件并退出，:q不保存并退出当前文件，:q!不保存并强制退出当前文件 下面就可以对配置文件进行修改了！ 修改为五秒内执行一次操作就出发RDB备份 接着 再查找rdbcompression后修改为yes即可 使用:wq保存并退出 rdb文件名修改后使用终端再次运行Redis，发现此时没有DB文件录入消息，之前的dump.rdb文件已不能被读取 到另一个终端重新使用redis-cli开启命令行，使用get num命令发现结果为空，再set 一个新的键值，回到Redis窗口发现出现Background saving started字段即表示成功！ "},{"title":"VMware软件安装及问题解决","date":"2022-10-08T03:26:00.000Z","url":"/2022/10/08/VMware%E5%AE%89%E8%A3%85/","tags":[["问题解决","/tags/%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3/"]],"categories":[["Linux","/categories/Linux/"]],"content":"VMware软件安装 前言：最近学习Redis时需要使用Linux系统，导致不得不去安装一个虚拟机了，在准备安装VMware软件时遇到了一些问题，这里给出记录和解决方案，以做参考学习使用 准备工作 本文将在Windows系统下使用VMware软件配置Linux虚拟机，下文将会详解VMware软件的安装步骤 VMware软件下载地址： Linux CentOS 7版本下载映像文件地址： 按图片所示下载即可 这里我选择的是CentOS-7.0-x86_64-DVD-2009.iso 版本 在下载路径下右键以管理员身份运行 在这里要敲重点！！！如果你没有以管理员身份运行这个选项，那么就看接下来的问题解决部分，如果你有这个选项请点击跳转自行无视。 问题解决 按住快捷键Win+R打开运行窗口，输入“regedit”， 这样就打开了注册表编辑器 在编辑器左侧依次找到HKEY_CURRENT_USER 然后将RestrictToPermittedSnapins的值设置为0 上面的方法如果输入路径后发现MMC不存在，那么下面这个方法就派上用场了！ 按下Win + R键打开运行，输入gpedit.msc打开组策略编辑器，这里可能你又会惊讶的发现，gpedit.msc打不开了！别着急，下面还有解决方案。当然，如果你能打开组策略编辑器的话可以点击这里继续往下看 对于无法打开组策略编辑器的情况，win + r 键打开运行后，输入notepad打开记事本，复制粘贴以下内容 记事本左上角文件另存为到任意路径下 文件名写为gpedit.cmd，保存类型选择所有文件，编码选择ANSI 点击保存后在你保存的路径下右键以管理员身份运行 等待运行结束后发现win + R键打开的gpedit.msc可以正常打开了 接下来进入组策略编辑器，双击计算机配置 --&gt; Windows设置 --&gt; 安全设置 双击本地策略 进入安全选项找到下面两项选择已启用 大功告成！！！ 安装VMware 当解决上述问题后开始准备下载VM软件了，右键以管理员身份运行后等待片刻来到安装界面 一路下一步来到这个界面，安装路径自己选择，我选择安装在D盘下的目录里 勾选取消“启动时检查产品更新” 一路下一步，点击安装 点击许可证 这里要输入许可证密钥（这里大家自行网络上获取），然后点击输入，安装结束，注意不要误点到跳过了。 输入密钥确认安装后就可以使用VMware了！"}]