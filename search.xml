<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Redis持久化问题排查</title>
    <url>/2022/10/29/Redis%E6%8C%81%E4%B9%85%E5%8C%96%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/</url>
    <content><![CDATA[<h2 id="redis持久化问题排查">Redis持久化问题排查</h2>
<blockquote>
<p>前言：在学习黑马的Redis持久化课程时因为老师用的MobaXterm软件与我使用的VMware存在差异，同时，老师上传的视频的redis配置与我大为不同而导致了一系列的问题，在进行了一天的排查（死杠）后终于解决了问题，感慨良多。在遇到问题解决不了的时候还是要多回头看，没准在出发点就能找到问题了。
下面就将展示问题的描述和解决方案</p>
</blockquote>
<h3 id="问题描述">问题描述</h3>
<blockquote>
<p>老师在使用MobaXterm软件时使用<code>redis-server redis.conf</code>命令指定配置文件在<strong>前台</strong>启动Redis</p>
<p>然而我在使用redis-server命令却出现了下面的两种情况：</p>
</blockquote>
<p>第一种：不指定配置文件启动Redis</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291124212.png"></p>
<p>发现监听6379端口失败</p>
<p>第二种：指定配置文件启动Redis</p>
<p>这里要先cd到自己的Redis安装路径下，然后使用命令<code>redis-server redis.conf</code></p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291126030.png"></p>
<p>发现没有产生日志，这里使用<code>ps -ef | grep redis</code>查看后端端口占用情况</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291127803.png"></p>
<p>显然，后台端口已经被占用了，这里是因为Redis配置了开机自启动和后台启动，导致端口占用而无法使用redis-server命令</p>
<h3 id="问题解决">问题解决</h3>
<p>在执行以下操作前建议使用VMware创建一个快照，防止后续操作不当导致虚拟机设置出现问题<br></p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282129924.png"></p>
<p>先使用以下命令关闭后台端口</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 关闭Redis后台启动，xxx是自己设置的密码</span></span><br><span class="line">redis-cli -p 6379 -a xxxx shutdown</span><br></pre></td></tr></table></figure>
<p>此时cd到Redis的安装目录下，使用命令<code>ps -ef | grep redis</code>查看后台端口占用情况，发现后台端口关闭</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291139316.png"></p>
<p>然后在当前路径下使用<code>vi redis.conf</code>关闭Redis后台启动</p>
<p>将 daemonize 修改为 no</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291141606.png"></p>
<p>这样Redis就不会在后台启动了！</p>
<p>接着可以开心的使用<code>redis-server redis.conf</code>指定配置文件启动redis了！</p>
<p>然而，如果你使用该命令后又出现了如下情况</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291145134.png"></p>
<p>发现当前窗口确实是像前台启动一样阻塞的，但是却没有任何日志信息输出，这时我们打开RESP等图形化界面看一下连接是否成功</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291146893.png"></p>
<p>嗯，确实成功了，说明Redis服务确实启动了，但还是没有日志文件，那么这是怎么回事呢？</p>
<p>哈哈，不用着急，我们先使用<code>ctrl + c</code>停止当前端口，然后再回到RESP上发现连接终止，这就说明我们之前做的操作没有问题！现在我们回到终端，使用<code>vi redis.conf</code>命令进入到配置文件中</p>
<p>找到<strong>logfile</strong>，发现logfile后面的引号内为一个日志文件</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291150818.png"></p>
<p>这个时候一切都真相大白了，因为在一开始配置Redis时，我们将在logfile的引号内<strong>写入了一个日志文件名称</strong>（一开始的logfile内的引号默认是空的），这就导致了我们使用redis-server命令输出的日志都进入到这个日志文件中，所以启动时当然看不到任何信息了！现在我们将引号内的文件命删除，保存并退出</p>
<p>再次使用<code>redis-server redis.conf</code>命令启动Redis</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291153693.png"></p>
<p>启动成功，大功告成！</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>问题解决</tag>
      </tags>
  </entry>
  <entry>
    <title>VMWare演示Redis持久化</title>
    <url>/2022/10/28/VMWare%E6%BC%94%E7%A4%BARedis%E6%8C%81%E4%B9%85%E5%8C%96/</url>
    <content><![CDATA[<h2 id="vmware演示redis持久化">VMware演示Redis持久化</h2>
<h3 id="redis持久化的作用">Redis持久化的作用</h3>
<p>Redis是内存存储，如果出现服务器宕机、服务重启等情况可能会丢失数据，利用Redis持久化可以将数据写入磁盘中，这样Redis就可以利用持久化的文件进行数据恢复，数据安全性得以大大提升。<br></p>
<h3 id="rdb">RDB</h3>
<blockquote>
<p>RDB全称为Redis Database Backup
file(Redis数据备份文件)，也被叫做Redis数据快照。简单来说就是把内存重的所有数据都记录道磁盘中。当Redis实例故障重启后，从磁盘读取快照文件，恢复数据。</p>
</blockquote>
<p>RDB实现数据持久化有两种命令：<code>save</code>和<code>bgsave</code></p>
<p>save命令适合用于准备将Redis停机的情况。</p>
<p>在执行save命令时会占用Redis的主进程，阻塞所有命令，因此不适用于Redis正在运行的情况。</p>
<p>而bgsave命令会执行fork操作开启一个子进程，避免主进程收到影响。</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282119328.png"></p>
<p>此外，当Redis停机时会执行一次RDB操作进行数据备份。</p>
<p>下面将对该情况进行验证</p>
<h3 id="rdb演示">RDB演示</h3>
<p>使用<code>redis-server redis.conf</code>指令在任意路径下运行Redis</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291303145.png"></p>
<p>接下来创建一个新的终端创建连接，存入键值对</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301657349.png"></p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301708367.png"></p>
<p>接着回到上一个终端使用<code>ctrl + c</code>关闭Redis，可以看到<code>DB saved on disk</code>表示文件正常保存</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282139525.png"></p>
<p>在当前路径下使用ll查看所有文件，看到dump.rdb快照文件已经生成<img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282141216.png"></p>
<p>接着再次在当前终端使用<code>redis-server redis.conf</code>启动Redis，此时数据会自动恢复，回到另一个终端窗口</p>
<p>此时将使用<code>ctrl + c</code>关闭当前命令行客户端，重新使用<code>redis-cli</code>开启一个新的命令行</p>
<p>这时使用get num命令发现数据返回为789，（如果get
num返回错误<strong>Error：Server closed the
connection</strong>要将redis.conf的<strong>protected-mode</strong>设置为No关闭保护模式）表明数据备份成功</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301704159.png"></p>
<p><strong>Redis停机自动执行RDB证明完毕！</strong></p>
<h3 id="实现rdb的相关配置">实现RDB的相关配置</h3>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282152250.png"></p>
<p>这里需要 cd 到redis的安装目录下，我的安装目录在
/usr/local/src/redis-6.2.6下</p>
<p>这里老师用的MobaXterm可以直接使用第三方文件打开配置文件进行修改，因为我用的是VMware所以只能使用Linux命令进行修改配置</p>
<p>使用 <code>vi redis.conf</code>修改配置文件</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282159322.png"></p>
<p>这里有一些小技巧：</p>
<ul>
<li>按下INSERT键进入修改状态，此时才可以对文件进行修改</li>
<li>按下ESC键可以使用一些命令：<code>/xxx</code>可以查找跳跃到当前文件中的xxx名称，<code>:wq</code>保存当前文件并退出，<code>:q</code>不保存并退出当前文件，<code>:q!</code>不保存并强制退出当前文件</li>
</ul>
<p>下面就可以对配置文件进行修改了！</p>
<p>修改为五秒内执行一次操作就出发RDB备份</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282209053.png"></p>
<p>接着</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282211172.png"></p>
<p>再查找rdbcompression后修改为yes即可</p>
<p>使用:wq保存并退出</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282214630.png"></p>
<p>rdb文件名修改后使用终端再次运行Redis，发现此时没有DB文件录入消息，之前的dump.rdb文件已不能被读取</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291316731.png"></p>
<p>到另一个终端重新使用redis-cli开启命令行，使用get
num命令发现结果为空，再set
一个新的键值，回到Redis窗口发现出现<code>Background saving started</code>字段即表示成功！</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210282221596.png"></p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210291318662.png"></p>
<h3 id="aof">AOF</h3>
<blockquote>
<p>AOF全称为Append Only File
(追加文件)。Redis处理的每一个写命令都会记录在AOF文件，可以看做是命令日志文件。</p>
</blockquote>
<p>开启AOF需要在Redis的配置文件中修改配置，AOF记录命令的频率有三种:<code>always</code>
、<code>everysec</code>和<code>no</code></p>
<p>always配置胜在能记录每一次Redis执行的写命令，几乎不会丢失数据，但对性能会有很大的影响</p>
<p>everysec配置每隔一秒将缓冲区里的数据写入到AOF文件，避免直接对AOF文件操作而性能上有了提升，但是在数据间隔的一秒内如果出现服务宕机的情况会丢失最多一秒的数据</p>
<p>no配置执行频率最低，性能最好，但是可靠性很低，不推荐使用</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301559763.png"></p>
<h3 id="aof演示">AOF演示</h3>
<p>先使用 cd 命令进入到Redis的安装路径下</p>
<p>使用<code>vi redis.conf</code>命令修改redis配置文件</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301615021.png"></p>
<p>将之前的save 5 1注释掉，写入save ""，表示禁用RDB</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301617321.png"></p>
<p>将appendonly修改为yes，开启AOF</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301618239.png"></p>
<p>AOF执行频率的命令配置默认为<code>appendfsync everysec</code>，不需要修改</p>
<p>修改完毕后回到终端，使用<code>rm -rf *.rdb</code>删除之前的RDB文件</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301622298.png"></p>
<p>可以看到当前目录下rdb文件已删除</p>
<p>使用<code>redis-server redis.conf</code>命令重启Redis</p>
<p>发现日志中出现没有对RDB的读取，修改成功</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301626879.png"></p>
<p>在另一终端打开命令行，输入如下指令</p>
<p>返回空集合，说明所有数据已被清除</p>
<figure>
<img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301703747.png" alt="img">
<figcaption aria-hidden="true">img</figcaption>
</figure>
<p>set一个键值对</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301630032.png"></p>
<p>这时我们打开文件夹进入本机的Redis的安装路径下，发现AOF文件已经被创建成功，打开AOF文件，set命令已经被写入成功，说明<strong>AOF已经生效了</strong></p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301633106.png"></p>
<p>接下来验证AOF的重启恢复，先重启Redis服务，红框内的日志表示数据已经从AOF文件加载完毕</p>
<p><img src="/2022/10/28/VMWare%E6%BC%94%E7%A4%BARedis%E6%8C%81%E4%B9%85%E5%8C%96/Users\86130\AppData\Roaming\Tencent\Users\2484792357\QQ\WinTemp\RichOle\LBDM52Q%5BBMBTK%7DPKDK~HB2V.png"></p>
<p>这时候我们回到命令行使用<code>keys *</code>命令，返回num，依然有数据，说明AOF重启能保证数据的恢复，证明完毕</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301640485.png"></p>
<h3 id="rdb和aof的比较">RDB和AOF的比较</h3>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202210301647804.png"></p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>学习笔记</tag>
      </tags>
  </entry>
  <entry>
    <title>VMware软件安装及问题解决</title>
    <url>/2022/10/08/VMware%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h2 id="vmware软件安装">VMware软件安装</h2>
<blockquote>
<p>前言：最近学习Redis时需要使用Linux系统，导致不得不去安装一个虚拟机了，在准备安装VMware软件时遇到了一些问题，这里给出记录和解决方案，以做参考学习使用</p>
</blockquote>
<h3 id="准备工作">准备工作</h3>
<blockquote>
<p>本文将在Windows系统下使用VMware软件配置Linux虚拟机，下文将会详解VMware软件的安装步骤</p>
</blockquote>
<p>VMware软件下载地址：<a href="https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html">https://www.vmware.com/cn/products/workstation-pro/workstation-pro-evaluation.html</a><br>
Linux CentOS 7版本下载映像文件地址：<a href="http://mirrors.aliyun.com/centos/7/isos/x86_64/">http://mirrors.aliyun.com/centos/7/isos/x86_64/</a><br></p>
<p>按图片所示下载即可</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262109879.png"></p>
<p>这里我选择的是CentOS-7.0-x86_64-DVD-2009.iso 版本</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262106973.png"></p>
<p>在下载路径下右键以管理员身份运行</p>
<p><strong>在这里要敲重点！！！如果你没有以管理员身份运行这个选项，那么就看接下来的问题解决部分，如果你有这个选项请点击<a href="#1">跳转</a>自行无视。</strong></p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262117313.png"></p>
<h3 id="问题解决">问题解决</h3>
<blockquote>
<p>按住快捷键Win+R打开运行窗口，输入“regedit”，</p>
<p>这样就打开了注册表编辑器</p>
<p>在编辑器左侧依次找到HKEY_CURRENT_USER</p>
<p>然后将RestrictToPermittedSnapins的值设置为0</p>
</blockquote>
<p>上面的方法如果输入路径后发现MMC不存在，那么下面这个方法就派上用场了！</p>
<p>按下Win +
R键打开运行，输入gpedit.msc打开组策略编辑器，这里可能你又会惊讶的发现，gpedit.msc打不开了！别着急，下面还有解决方案。当然，如果你能打开组策略编辑器的话可以点击<a href="#2">这里</a>继续往下看</p>
<p>对于无法打开组策略编辑器的情况，win + r
键打开运行后，输入notepad打开记事本，复制粘贴以下内容</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"><span class="built_in">pushd</span> <span class="string">&quot;%~dp0&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientExtensions-Package~3*.mum &gt;List.txt</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span> /b C:\Windows\servicing\Packages\Microsoft-Windows-GroupPolicy-ClientTools-Package~3*.mum &gt;&gt;List.txt</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> /f %%i <span class="keyword">in</span> (<span class="string">&#x27;findstr /i . List.txt 2^&gt;nul&#x27;</span>) <span class="keyword">do</span> dism /online /norestart /add-package:<span class="string">&quot;C:\Windows\servicing\Packages\%%i&quot;</span></span><br><span class="line"></span><br><span class="line">pause</span><br></pre></td></tr></table></figure>
<p>记事本左上角文件另存为到任意路径下</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262129654.png"></p>
<p>文件名写为gpedit.cmd，保存类型选择所有文件，编码选择ANSI</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262131529.png"></p>
<p>点击保存后在你保存的路径下右键以管理员身份运行</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262132085.png"></p>
<p>等待运行结束后发现win + R键打开的gpedit.msc可以正常打开了<br></p>
<p><span id="2"></span></p>
<p>接下来进入组策略编辑器，双击计算机配置 --&gt; Windows设置 --&gt;
安全设置<br></p>
<p>双击本地策略</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262139507.png"></p>
<p>进入安全选项找到下面两项选择已启用</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262141895.png"></p>
<p><strong>大功告成！！！</strong></p>
<p><span id="1"></span></p>
<h3 id="安装vmware">安装VMware</h3>
<p>当解决上述问题后开始准备下载VM软件了，右键以管理员身份运行后等待片刻来到安装界面</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262147272.png"></p>
<p>一路下一步来到这个界面，安装路径自己选择，我选择安装在D盘下的目录里</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262148344.png"></p>
<p>勾选取消“启动时检查产品更新”</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262149952.png"></p>
<p>一路下一步，点击安装</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262151352.png"></p>
<p>点击许可证</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262153587.png"></p>
<p>这里要输入许可证密钥（这里大家自行网络上获取），然后点击输入，安装结束，注意不要误点到跳过了。</p>
<p><img src="https://modox.oss-cn-hangzhou.aliyuncs.com/img/202209262155195.png"></p>
<p>输入密钥确认安装后就可以使用VMware了！</p>
]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>问题解决</tag>
      </tags>
  </entry>
</search>
